\section{Introduction to language L}

The  L-system  formalism  is   the  foundation  on  which  programming
languages  for  plant modeling  tools  have  been  built. Though  they
usually include constructs  from general purpose programming languages
the key concept of these tools is the rewriting of modules or symbols.
The language L is no exception.

A module in L  has a name and can take any  number of arguments of any
type in C++.   A syntactically correct rule consists  of a predecessor
possibly with its context ending  with colon and a production defining
successor string embraced within  curly braces.  For example the third
rule in Eq.  \ref{eq:ca110} is written in L as:
\begin{equation}\label{eq:r3}
 O() < X() > O(): \{\mathrm{produce}\ X();\}
\end{equation}

For branching structures of plants L predefines two modules $SB()$ and
$EB()$ denoting begin and end  of branch respectively.  To control the
movements of the turtle (the  geometry engine) let us first define its
orientation  in space by  three unit  vectors $\vec  H$, $\vec  L$ and
$\vec U$ perpendicular to each other such that $\vec U = \vec H \times
\vec L$ denoting turtle's heading,  direction to the left and up. Then
define module $F(s)$ to move the turtle forward along its heading step
of  length  $s$  and  three modules  $Turn(\alpha)$,  $Pitch(\alpha)$,
$Roll(\alpha)$ to  rotate orientation of  the turtle around  $\vec U$,
$\vec  L$  and $\vec  H$  by  $\alpha$.   One special  module  $Start$
corresponds to the axiom.

To model tree structures with L as in LIGNUM let the module $F$ denote
tree segment and designate module  $B$ for bud.  Given the modules for
turtle  graphics  and  branching  we  can now  describe  topology  and
geometry of  the tree structures  of LIGNUM (Eq.   \ref{eq:tree}) with
rules of  L (Eq.  \ref{eq:r3}). To  accommodate L with  LIGNUM we need
first  to construct  an  algorithm  that translates  strings  of L  to
structural  units  of  LIGNUM  (Section \ref{sec:pine}).   Second,  as
metabolism  implemented  in  LIGNUM   will  act  on  structural  units
(segments  and  buds  most  notably)  and produces  changes  in  their
physiological states,  in their dimensions  and in their  positions in
space  accordingly, this  information  must be  transferred to  turtle
symbols  and  module  $B$   (Section  \ref{sec:bearberry})  as  it  is
necessary in rewriting.

\section{Scots pine: integrating L and LIGNUM}\label{sec:pine}
To present algorithm that translates  strings of L to structural units
of LIGNUM  the first  example mimics the  growth of young  Scots pine.
First,  introduce  module $B(A,L)$  representing  a  bud.  The  module
definition implements development for  the main stem and the branching
evolution.  In each  iteration the apical bud ($A  = 1$) moves forward
of length $L$ and forks off  four new side branches.  The branches ($A
> 1  $) are  similar  but only  two  more side  branches are  created.
Branching stops after third order  ($A > 3$).  The definition for this
pine growth in L is  in Appendix \ref{sec:L1} (The explanation of open
and  close   statements  is  in   Section  \ref{sec:namespace}).   The
development starts from main axis consisting of one segment, branching
point  and   bud.   The  string   after  two  iterations  is   in  Eq.
\ref{eq:pine2} . Symbol [ denotes $SB()$ and ] denotes $EB()$, modules
for turtle rotations are not shown:
\begin{equation}\label{eq:pine2}
F\;[] F [F[B][B]B]\:[F[B][B]B]\:[F[B][B]B]\:[F[B][B]B]\; F \;[B][B][B][B]\; B
\end{equation}

We can now outline straightforward  algorithm to convert the string of
symbols in L to structural units in LIGNUM using Eq. \ref{eq:pine2} as
a particular example.   To start with, interpret the  symbol $F(s)$ as
tree segment  of length $s$.  The  symbol B corresponds  to bud.  Each
consecutive  set of $n$  branches between  two $F$  symbols will  be a
branching  point with  $n$ axes.   The string  in  Eq.  \ref{eq:pine2}
becomes  first the  main  axis with  three  segments, three  branching
points and the terminating bud:
\begin{equation}
[TS, BP, TS, BP, TS, BP, B]
\end{equation}
The  two last  branching  points  contains four  axes  each the  first
branching point being empty:
\begin{equation}
[TS, [], TS, [A,A,A,A], TS, [A,A,A,A], B]
\end{equation}
Finally, recursively constructing the axes we get:
\begin{equation}
[TS, [] TS,[TS,[[B],[B]],B],\ldots, [TS,[[B],[B]],B]], TS, [[B],[B],[B],[B]], B]
\end{equation}
Current status of  the turtle updated according to  turtle commands in
the  string   defines  the  position  and  orientation   of  the  tree
compartments in LIGNUM.

The structural development of the tree described in L does not require
the regeneration  of LIGNUM representation of trees  (deleting the old
tree and  creating a new one)  after each derivation.  In  our case we
can assume  that an L-system indeed generates  alternating sequence of
tree segments, branching points  and terminating buds and the terminal
buds only  generate new structural units.  Thus  after each derivation
it is possible to match  the existing string and LIGNUM representation
and  insert the  new structural  units in  the axis  lists  before the
terminating buds whose positions and orientations will be updated.

The development  of three pines after eight  development steps (years)
is in  Fig.  \ref{fig:pine}.  The leftmost  pine is the  result of the
L-system (Appendix \ref{sec:L1}) rewriting only.  The two pines in the
middle and  in the right incorporate  our previous work  on Scots pine
metabolism  to  that  L-system  \citep{perttunen:98}.   Most  notably,
recall the pairwise comparison of segments to compute the intercept of
solar radiation and the  iterative allocation of net photosynthates to
growth  after  respiration  costs.   The  parameter  values  are  from
\citet[Table  1]{perttunen:98}.  We  omit the  function for  number of
secondary  buds \citep[][Fig.  2]{perttunen:98}  and let  the L-system
determine branching.

The  simulations show the  effect of  two different  foliage mortality
models. The foliage in the  pine in the middle of Fig.  \ref{fig:pine}
remain five years \citep[][Fig.   2]{perttunen:98}. The foliage in the
pine  in  the  right   remains  one  year  only  (admittedly  slightly
unrealistic scenario).  The simulation  shows much shorter and slimmer
stem due  to less need  for diameter growth  for the pine of  one year
foliage.


